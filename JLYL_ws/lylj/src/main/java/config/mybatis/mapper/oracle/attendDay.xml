<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.it.lylj.attendDay.model.AttendDayDAO">

	<select id="selectAttendDayByRegdate" parameterType="attendDayVo" resultType="attendDayVo">
		select * from ATTENDDAY 
		where EMP_NO=${empNo} and ATTENDANCE_DAY_REGDATE = TRUNC(#{attendanceDayRegdate})
	</select>
	
	<select id="selectAttendMonth" parameterType="hashmap" resultType="attendDayVo">
		select * from ATTENDDAY 
		where EMP_NO=${empNo} and ATTENDANCE_DAY_REGDATE between TO_DATE(#{firstDate:VARCHAR}) and TO_DATE(#{lastDate:VARCHAR})
		order by ATTENDANCE_DAY_REGDATE
	</select>
	
	<select id="selectSumWeekWork" resultType="int">
		select TRUNC(sum((ATTENDANCE_DAY_OFF_HOUR -ATTENDANCE_DAY_ON_HOUR)*24*60*60))   from ATTENDDAY
		where ATTENDANCE_DAY_OFF_HOUR is not null and ATTENDANCE_DAY_REGDATE  between TRUNC(SYSDATE,'d') and SYSDATE
	</select>
	
	<select id="selectSumWeekWorkEx" resultType="int">
		select NVL(TRUNC(sum((ATTENDANCE_DAY_OFF_HOUR - to_date(to_char(ATTENDANCE_DAY_OFF_HOUR,'yyyy-MM-dd')||' 18:00:00','yyyy-MM-dd hh24:mi:ss'))*24*60*60)),0) from ATTENDDAY a
		where ATTENDANCE_DAY_OFF_HOUR > to_date((select to_char(ATTENDANCE_DAY_OFF_HOUR,'yyyy-MM-dd')||' 18:00:00' from ATTENDDAY b 
        where a.ATTENDANCE_DAY_NO  = b.ATTENDANCE_DAY_NO   and ATTENDANCE_DAY_OFF_HOUR is not null ), 'yyyy-MM-dd hh24:mi:ss')
        and ATTENDANCE_DAY_REGDATE  between TRUNC(SYSDATE,'d') and SYSDATE
	</select>
	
	<select id="selectSumMonthWork" resultType="int">
		select TRUNC(sum((ATTENDANCE_DAY_OFF_HOUR -ATTENDANCE_DAY_ON_HOUR)*24*60*60))   from ATTENDDAY
		where ATTENDANCE_DAY_OFF_HOUR is not null and ATTENDANCE_DAY_REGDATE  between TRUNC(SYSDATE,'MM') and SYSDATE
	</select>
	
	<select id="selectSumMonthWorkEx" resultType="int">
		select NVL(TRUNC(sum((ATTENDANCE_DAY_OFF_HOUR - to_date(to_char(ATTENDANCE_DAY_OFF_HOUR,'yyyy-MM-dd')||' 18:00:00','yyyy-MM-dd hh24:mi:ss'))*24*60*60)),0)   from ATTENDDAY a
		where ATTENDANCE_DAY_OFF_HOUR > to_date((select to_char(ATTENDANCE_DAY_OFF_HOUR,'yyyy-MM-dd')||' 18:00:00' from ATTENDDAY b 
        where a.ATTENDANCE_DAY_NO  = b.ATTENDANCE_DAY_NO   and ATTENDANCE_DAY_OFF_HOUR is not null ), 'yyyy-MM-dd hh24:mi:ss')
        and ATTENDANCE_DAY_REGDATE  between TRUNC(SYSDATE,'MM') and SYSDATE
	</select>
	
	<select id="selectSumWeekWorkByMonth" resultType="int" parameterType="hashmap">
		select NVL(TRUNC(SUM((ATTENDANCE_DAY_OFF_HOUR -ATTENDANCE_DAY_ON_HOUR)*24*60*60)),0)   from ATTENDDAY
		where ATTENDANCE_DAY_OFF_HOUR is not null and ATTENDANCE_DAY_REGDATE  between TO_DATE(#{startDate:VARCHAR}) and TO_DATE(#{endDate:VARCHAR}) and EMP_NO=${empNo}
	</select>
	
	<insert id="insertAttendDay" parameterType="attendDayVo">
		insert into ATTENDDAY 
		values(ATTENDDAY_SEQ.nextval, #{empNo}, #{attendanceDayOnHour}, #{attendanceDayOffHour:DATE},
		#{attendanceDayWorkHour:DATE},#{attendanceDayHolidayFlag:VARCHAR},#{attendanceDayRegdate})
	</insert>
	
	<update id="updateAttendDayByOffHour" parameterType="attendDayVo">
		update ATTENDDAY set ATTENDANCE_DAY_OFF_HOUR=#{attendanceDayOffHour},
		ATTENDANCE_DAY_WORK_HOUR=#{attendanceDayWorkHour}
		where EMP_NO=#{empNo} and ATTENDANCE_DAY_REGDATE =#{attendanceDayRegdate}
	</update>
	
	
 </mapper>









